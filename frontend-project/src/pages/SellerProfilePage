import React, { useEffect, useState } from 'react';
import { useParams, useNavigate } from 'react-router-dom';
import { fetchSellerProfile } from '../../api/sellerApi';
import { resolveProjectImageUrl } from '../../utils/projectMedia'; // 이미지 경로 처리 함수
import Header from '../../components/Header';
import '../../styles/SellerProfile.css'; // 스타일 파일 (아래 참고)

const SellerProfilePage = () => {
    const { sellerNo } = useParams(); // URL에서 sellerNo 가져오기
    const navigate = useNavigate();
    
    const [sellerInfo, setSellerInfo] = useState(null);
    const [loading, setLoading] = useState(true);

    useEffect(() => {
        const loadData = async () => {
            try {
                const data = await fetchSellerProfile(sellerNo);
                setSellerInfo(data);
            } catch (error) {
                alert("존재하지 않는 판매자입니다.");
                navigate(-1);
            } finally {
                setLoading(false);
            }
        };
        loadData();
    }, [sellerNo, navigate]);

    if (loading) return <div>로딩 중...</div>;
    if (!sellerInfo) return null;

    return (
        <div className="seller-page-wrapper">
            <Header />
            
            {/* 1. 판매자 프로필 영역 */}
            <div className="seller-profile-header">
                <div className="seller-profile-card">
                    <img 
                        src={resolveProjectImageUrl(sellerInfo.sellerImage, '/default-profile.png')} 
                        alt="판매자 프로필" 
                        className="seller-img"
                    />
                    <div className="seller-info">
                        <h2 className="seller-name">{sellerInfo.sellerName}</h2>
                        <p className="seller-bio">{sellerInfo.introduction}</p>
                        <div className="seller-stats">
                            <div className="stat-item">
                                <span className="label">팔로워</span>
                                <span className="value">{sellerInfo.followerCount}</span>
                            </div>
                            <div className="stat-item">
                                <span className="label">프로젝트</span>
                                <span className="value">{sellerInfo.projectCount}</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            {/* 2. 판매자 프로젝트 리스트 영역 */}
            <div className="seller-projects-container">
                <h3 className="section-title">진행한 프로젝트 ({sellerInfo.projectList.length})</h3>
                
                {sellerInfo.projectList.length > 0 ? (
                    <div className="project-grid">
                        {sellerInfo.projectList.map((project) => (
                            <div 
                                key={project.productNo} 
                                className="project-card"
                                onClick={() => navigate(`/projects/${project.productNo}`)}
                            >
                                <div className="img-wrapper">
                                    <img src={resolveProjectImageUrl(project.thumbnail)} alt={project.title} />
                                </div>
                                <div className="card-body">
                                    <h4 className="project-title">{project.title}</h4>
                                    <div className="project-meta">
                                        <span className="rate">{project.achievementRate}% 달성</span>
                                        {/* 필요한 경우 금액이나 남은 일수 추가 */}
                                    </div>
                                </div>
                            </div>
                        ))}
                    </div>
                ) : (
                    <div className="empty-state">진행한 프로젝트가 없습니다.</div>
                )}
            </div>
        </div>
    );
};

export default SellerProfilePage;