<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="projectInteractionMapper">

    <!-- 좋아요 집계 / 상태 -->
    <select id="countLikes" parameterType="long" resultType="long">
        SELECT COUNT(*)
        FROM TB_LIKE
        WHERE PRODUCT_NO = #{productNo}
    </select>

    <select id="hasLiked" parameterType="map" resultType="int">
        SELECT COUNT(*)
        FROM TB_LIKE
        WHERE PRODUCT_NO = #{productNo}
          AND USER_NO = #{userNo}
    </select>

    <insert id="insertLike" parameterType="map">
        INSERT INTO TB_LIKE (PRODUCT_NO, USER_NO)
        SELECT #{productNo}, #{userNo}
        FROM DUAL
        WHERE NOT EXISTS (
            SELECT 1
            FROM TB_LIKE
            WHERE PRODUCT_NO = #{productNo}
              AND USER_NO = #{userNo}
        )
    </insert>

    <delete id="deleteLike" parameterType="map">
        DELETE FROM TB_LIKE
        WHERE PRODUCT_NO = #{productNo}
          AND USER_NO = #{userNo}
    </delete>

    <!-- 팔로우 집계 / 상태 -->
    <select id="countFollowers" parameterType="long" resultType="long">
        SELECT COUNT(*)
        FROM FOLLOW
        WHERE SELLER_NO = #{sellerNo}
    </select>

    <select id="isFollowing" parameterType="map" resultType="int">
        SELECT COUNT(*)
        FROM FOLLOW
        WHERE SELLER_NO = #{sellerNo}
          AND FOLLOWING = #{userNo}
    </select>

    <insert id="insertFollow" parameterType="map">
        INSERT INTO FOLLOW (SELLER_NO, FOLLOWING)
        SELECT #{sellerNo}, #{userNo}
        FROM DUAL
        WHERE NOT EXISTS (
            SELECT 1
            FROM FOLLOW
            WHERE SELLER_NO = #{sellerNo}
              AND FOLLOWING = #{userNo}
        )
    </insert>

    <delete id="deleteFollow" parameterType="map">
        DELETE FROM FOLLOW
        WHERE SELLER_NO = #{sellerNo}
          AND FOLLOWING = #{userNo}
    </delete>

</mapper>
