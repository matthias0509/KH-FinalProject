<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="sellerMapper">

    <select id="selectSellerNoByUser" parameterType="long" resultType="long">
        SELECT SELLER_NO
        FROM SELLER_PROFILE
        WHERE USER_NO = #{userNo}
        AND ROWNUM = 1  
     </select>

    <select id="selectSellerProfile" parameterType="long" resultType="com.kh.foodding.project.model.vo.SellerProfile">
        SELECT
            sp.SELLER_NO AS sellerNo,
            sp.USER_NO AS userNo,
            sp.INTRODUCTION AS introduction,
            u.USER_NAME AS sellerName,
            u.NICKNAME AS nickname,
            u.EMAIL AS email,
            u.PHONE AS phone,
            u.MODIFY_PROFILE AS profileImage
        FROM SELLER_PROFILE sp
        JOIN TB_USER u ON sp.USER_NO = u.USER_NO
        WHERE sp.SELLER_NO = #{sellerNo}
    </select>

    <insert id="insertSellerProfile" parameterType="map">
        <selectKey resultType="long" keyProperty="sellerNo" order="BEFORE">
            SELECT SEQ_SELLER_PROFILE_NO.NEXTVAL FROM DUAL
        </selectKey>
        INSERT INTO SELLER_PROFILE (
            SELLER_NO,
            INTRODUCTION,
            USER_NO
        ) VALUES (
            #{sellerNo},
            NVL(#{introduction}, '신규 메이커입니다.'),
            #{userNo}
        )
    </insert>

</mapper>